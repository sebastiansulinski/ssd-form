/*
 * ssdForm jQuery plugin
 * Examples and documentation at: https://github.com/sebastiansulinski/ssd-form
 * Copyright (c) 2017 Sebastian Sulinski
 * Version: 1.4.1 (17-JULY-2017)
 * Licensed under the MIT.
 * Requires: jQuery v1.9 or later
 */
!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],function(e){return t(e)}):"object"==typeof exports?module.exports=t(require("jquery")):t(e.jQuery)}(this,function(e){!function(){"use strict";e.fn.ssdForm=function(t){var n=e.extend({dataFormWrapper:"data-form-wrapper",dataConfirmation:"data-confirmation",dataValidationSegment:"data-validation",dataValidationCase:"data-case",dataRegex:"data-regex",dataSubmitTrigger:"data-submit-trigger",dataSubmitPending:"data-submit-pending",classHide:"hide",classShow:"show",extendBehaviours:{},extendValidationRules:{},postAjaxSuccess:function(e,t,n){e.successBehaviour(t,n)},postAjaxFailure:function(e,t,n,i,a){e.endRequestDisplayErrors(t,n.responseJSON)},ignoreElements:".button, [disabled]",serializeAttribute:null,actionMethod:function(t,n,i,a){e.ajax({method:n.method(),url:n.action(),data:n.data(),dataType:"json",cache:!1,success:i,error:a})}},t),i="["+n.dataFormWrapper+"]",a="["+n.dataConfirmation+"]",r="["+n.dataValidationSegment+"]",o="["+n.dataValidationCase+"]",s="["+n.dataSubmitTrigger+"]",u=(n.dataRegex,"["+n.dataSubmitPending+"]"),c=function(){var e={};this.add=function(t,n){if(e.hasOwnProperty(t))return!1;e[t]=n},this.all=function(){return e},this.empty=function(){return 0===Object.keys(e).length}},d={replace:function(t){void 0!==t.replace&&e.each(t.replace,function(t,n){e("[data-"+t+"]").html(n)})},remove:function(t){void 0!==t.remove&&e.each(t.remove,function(t,n){e("[data-"+n+"]").remove()})},reload:function(){window.location.reload(!0)},redirect:function(e){window.location.href=e}},l=e.extend({elements:[],required:function(e){return!(""===e.value||null===e.value||void 0===e.value)},checked:function(e){return e.isChecked},value_is:function(e){return e.value===e.rules_collection[0]},email:function(e){return/^[a-zA-Z0-9._\-]+@[a-zA-Z0-9]+([.\-]?[a-zA-Z0-9]+)?([\.]{1}[a-zA-Z]{2,4}){1,4}$/.test(e.value)},password:function(e){return/(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/.test(e.value)},min:function(e){return e.value.length>=e.rules_collection[0]},max:function(e){return e.value.length<=e.rules_collection[0]},confirmed:function(e){var t=e.name+"_confirmation",n=this.elements.filter(function(e,n){return n.name===t})[0];if(0===n.length)throw new Error(e.name+"_confirmation field is missing");return n.value===e.value},regex:function(e){return new RegExp(e.regex).test(e.value)},test:function(t,n){var i=this,a=e.Deferred();return i.elements=t,e.each(n.rules,function(e,t){var r=t.split(":"),o=r.shift();n.rules_collection=r,i[o](n)||a.reject(o),e+1===n.rules.length&&a.resolve()}),a.promise()}},n.extendValidationRules),f=function(t,i){function a(e){return e.isVisible||e.isEditor}function r(t,n){return-1===e.inArray("required",n.rules)&&""===n.value||l.test(t,n)}function o(e,t,n){e+1===t&&(i.empty()?n.resolve():n.reject(i.all()))}if(!(t instanceof m))throw new Error("Invalid argument form_model.");if(!(i instanceof c))throw new Error("Invalid argument error.");this.run=function(){var s=t.inputs(),u=s.length,c=e.Deferred();return e.each(s,function(t,d){var l=e(this),f={instance:l,name:null===n.serializeAttribute?l.prop("name"):l.attr(n.serializeAttribute),type:l.prop("type"),value:l.prop("value"),rules:l.data("validate"),isChecked:l.is(":checked"),isVisible:l.is(":visible"),isEditor:l.hasClass("editor"),regex:l.data("regex")};return a(f)?void 0===f.rules||0===f.rules.length?(o(t,u,c),!0):(f.rules=f.rules.split("|"),void e.when(r(s,f)).done(function(){o(t,u,c)}).fail(function(e){i.add(f.name,e),o(t,u,c)})):(o(t,u,c),!0)}),c.promise()}},h=e.extend({redirect:function(e,t){if(!t.redirect)throw new Error("Redirect entry missing.");d.redirect(t.redirect)},reload:function(){d.reload()},fadeOutShowMessage:function(e,t){var n=e.instance().closest(i).find(a);e.instance().fadeOut(200,function(){n.html(t.message).fadeIn(200)})},fadeOutShowMessageRedirect:function(e,t){var n=e.instance().closest(i).find(a);e.instance().fadeOut(200,function(){n.html(t.message).fadeIn(200,function(){setTimeout(function(){window.location.href=t.redirect},3e3)})})},fadeOutShowMessageReload:function(e,t){var n=e.instance().closest(i).find(a);e.instance().fadeOut(200,function(){n.html(t.message).fadeIn(200,function(){setTimeout(function(){window.location.reload(!0)},3e3)})})},fadeOutShowMessageResetFadeIn:function(e,t){var n=e.instance().closest(i).find(a);e.instance().fadeOut(200,function(){v.endRequest(e),n.html(t.message).fadeIn(200),setTimeout(function(){n.fadeOut(200,function(){e.instance()[0].reset(),e.instance().fadeIn(200)})},3e3)})},callReplaceRemove:function(e,t){d.replace(t),d.remove(t)},ask:function(e,t){if(!this.hasOwnProperty(t.behaviour))throw new Error("Behaviour not specified.");this[t.behaviour](e,t)},run:function(e,t){var n=e.successBehaviour();if(!this.hasOwnProperty(n))throw new Error("Behaviour does not exist.");this[n](e,t)}},n.extendBehaviours),m=function(t){var i,a,r=t.find(":input").not(n.ignoreElements),o={method:t.prop("method"),action:t.prop("action"),successBehaviour:t.data("success-behaviour"),inputs:r,data:null===n.serializeAttribute?t.serializeArray():function(){var t=[];return r.each(function(){var i=e(this).attr(n.serializeAttribute),a=e(this).val();t.push({name:i,value:a})}),t}()};!function(){if(void 0===o.method&&(o.method="post"),void 0===o.action)throw new Error("No action defined.")}(),this.instance=function(){return t},this.method=function(){return o.method},this.action=function(){return o.action},this.successBehaviour=function(){return o.successBehaviour},this.inputs=function(){return o.inputs},this.data=function(){return o.data},this.validate=function(){return a=new c,(i=new f(this,a)).run()},this.reset=function(){t.trigger("reset")}},v={clearErrors:function(e){e.instance().find(r+" "+o).removeClass(n.classShow)},displayAlert:function(e){},displayErrors:function(t,i){var a;for(var r in i)if(i.hasOwnProperty(r)){if("alert"==r){this.displayAlert(i[r]);continue}a=e.isArray(i[r])?i[r][0]:i[r],t.instance().find("["+n.dataValidationSegment+'="'+r+'"] ['+n.dataValidationCase+'="'+a+'"]').addClass(n.classShow)}},beginRequest:function(e){if(e.instance().data("quiet"))return!0;e.instance().find(s).addClass(n.classHide),e.instance().find(u).removeClass(n.classHide)},endRequest:function(e){if(e.instance().data("quiet"))return!0;e.instance().find(s).removeClass(n.classHide),e.instance().find(u).addClass(n.classHide)},successBehaviour:function(e,t){h.run(e,t)},disableForm:function(e){this.submitted=e},enableForm:function(){this.submitted=null},endRequestDisplayErrors:function(e,t){this.endRequest(e),this.displayErrors(e,t)},endRequestDisplayErrorsReset:function(e,t){this.endRequestDisplayErrors(e,t),e.reset()},formAction:function(t,i,a,r){var o=this;e.when(t.validate()).done(function(e,r,s){o.beginRequest(t),n.actionMethod(o,t,i,a)}).fail(r)},submit:function(t){var i=this;e(t).on("submit",function(t){t.preventDefault();var a=new m(e(this));i.clearErrors(a),i.formAction(a,function(e){n.postAjaxSuccess(i,a,e)},function(e,t,r){n.postAjaxFailure(i,a,e,t,r)},function(e){i.endRequestDisplayErrors(a,e)})})},clickSubmit:function(){e(document).on("click",".clickSubmit",function(t){t.preventDefault(),t.stopPropagation();var n=e(this).data("target");e(n).submit()})},init:function(e){this.submit(e),this.clickSubmit()}};return v.init(this)}}()});