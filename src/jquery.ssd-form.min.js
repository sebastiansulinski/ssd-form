/*
 * ssdForm jQuery plugin
 * Examples and documentation at: https://github.com/sebastiansulinski/ssd-form
 * Copyright (c) 2017 Sebastian Sulinski
 * Version: 1.5.1 (25-DEC-2017)
 * Licensed under the MIT.
 * Requires: jQuery v1.9 or later
 */
!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],function(e){return t(e)}):"object"==typeof exports?module.exports=t(require("jquery")):t(e.jQuery)}(this,function(e){!function(){"use strict";e.fn.ssdForm=function(t){var n=e.extend({dataFormWrapper:"data-form-wrapper",dataConfirmation:"data-confirmation",dataValidationSegment:"data-validation",dataValidationCase:"data-case",dataSubmitTrigger:"data-submit-trigger",dataSubmitPending:"data-submit-pending",classCkEditor:"editor",classHide:"hide",classShow:"show",extendBehaviours:{},extendValidationRules:{},postAjaxSuccess:function(e,t,n){e.successBehaviour(t,n)},postAjaxFailure:function(e,t,n,i,a){e.endRequestDisplayErrors(t,n.responseJSON)},ignoreElements:".button, [disabled]",serializeAttribute:"name",actionMethod:function(t,n,i,a){e.ajax({method:n.method(),url:n.action(),data:n.data(),dataType:"json",cache:!1,success:i,error:a})}},t),i="["+n.dataFormWrapper+"]",a="["+n.dataConfirmation+"]",r="["+n.dataValidationSegment+"]",o="["+n.dataValidationCase+"]",s="["+n.dataSubmitTrigger+"]",u="["+n.dataSubmitPending+"]",c=function(){var e={};this.add=function(t,n){if(e.hasOwnProperty(t))return!1;e[t]=n},this.all=function(){return e},this.empty=function(){return 0===Object.keys(e).length}},d={replace:function(t){void 0!==t.replace&&e.each(t.replace,function(t,n){e("[data-"+t+"]").html(n)})},remove:function(t){void 0!==t.remove&&e.each(t.remove,function(t,n){e("[data-"+n+"]").remove()})},reload:function(){window.location.reload(!0)},redirect:function(e){window.location.href=e}},f=e.extend({elements:[],required:function(e){return!(""===e.value||null===e.value||void 0===e.value)},checked:function(e){return e.isChecked},value_is:function(e){return e.value===e.rules_collection[0]},email:function(e){return/^[a-zA-Z0-9._\-]+@[a-zA-Z0-9]+([.\-]?[a-zA-Z0-9]+)?([\.]{1}[a-zA-Z]{2,4}){1,4}$/.test(e.value)},password:function(e){return/(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/.test(e.value)},min:function(e){return e.value.length>=e.rules_collection[0]},max:function(e){return e.value.length<=e.rules_collection[0]},confirmed:function(e){var t=e.name+"_confirmation",n=this.elements.filter(function(e){return e.name===t})[0];if(!n)throw new Error(e.name+"_confirmation field is missing");return n.value===e.value},regex:function(e){var t=new RegExp(e.regex);return console.log(t),t.test(e.value)},test:function(t,n){var i=this,a=e.Deferred();return i.elements=t,e.each(n.rules,function(e,t){var r=t.split(":"),o=r.shift();n.rules_collection=r,i[o](n)||a.reject(o),e+1===n.rules.length&&a.resolve()}),a.promise()}},n.extendValidationRules),l=function(t,n){function i(e){return e.isVisible||e.isEditor}function a(t,n){return-1===e.inArray("required",n.rules)&&""===n.value||f.test(t,n)}function r(e,t,i){e+1===t&&(n.empty()?i.resolve():i.reject(n.all()))}if(!(t instanceof m))throw new Error("Invalid argument form_model.");if(!(n instanceof c))throw new Error("Invalid argument error.");this.run=function(){var o=t.data(),s=o.length,u=e.Deferred();return e.each(o,function(t,c){e(this);return i(c)?void 0===c.rules||0===c.rules.length?(r(t,s,u),!0):(c.rules=c.rules.split("|"),void e.when(a(o,c)).done(function(){r(t,s,u)}).fail(function(e){n.add(c.name,e),r(t,s,u)})):(r(t,s,u),!0)}),u.promise()}},h=e.extend({redirect:function(e,t){if(!t.redirect)throw new Error("Redirect entry missing.");d.redirect(t.redirect)},reload:function(){d.reload()},fadeOutShowMessage:function(e,t){var n=e.instance().closest(i).find(a);e.instance().fadeOut(200,function(){n.html(t.message).fadeIn(200)})},fadeOutShowMessageRedirect:function(e,t){var n=e.instance().closest(i).find(a);e.instance().fadeOut(200,function(){n.html(t.message).fadeIn(200,function(){setTimeout(function(){window.location.href=t.redirect},3e3)})})},fadeOutShowMessageReload:function(e,t){var n=e.instance().closest(i).find(a);e.instance().fadeOut(200,function(){n.html(t.message).fadeIn(200,function(){setTimeout(function(){window.location.reload(!0)},3e3)})})},fadeOutShowMessageResetFadeIn:function(e,t){var n=e.instance().closest(i).find(a);e.instance().fadeOut(200,function(){v.endRequest(e),n.html(t.message).fadeIn(200),setTimeout(function(){n.fadeOut(200,function(){e.instance()[0].reset(),e.instance().fadeIn(200)})},3e3)})},callReplaceRemove:function(e,t){d.replace(t),d.remove(t)},ask:function(e,t){if(!this.hasOwnProperty(t.behaviour))throw new Error("Behaviour not specified.");this[t.behaviour](e,t)},run:function(e,t){var n=e.successBehaviour();if(!this.hasOwnProperty(n))throw new Error("Behaviour does not exist.");this[n](e,t)}},n.extendBehaviours),m=function(t){var i,a,r=t.find(":input").not(n.ignoreElements),o={method:t.prop("method"),action:t.prop("action"),successBehaviour:t.data("success-behaviour"),data:function(){var t=[];return r.each(function(){var i=e(this),a=i.attr(n.serializeAttribute),r=i.val();i.hasClass(n.classCkEditor)&&(r=window.CKEDITOR.instances[i.attr("id")].getData()),t.push({name:a,value:r,type:i.prop("type"),rules:i.data("validate"),isChecked:i.is(":checked"),isVisible:i.is(":visible"),isEditor:i.hasClass("editor"),regex:i.data("regex")})}),t}()};!function(){if(void 0===o.method&&(o.method="post"),void 0===o.action)throw new Error("No action defined.")}(),this.instance=function(){return t},this.method=function(){return o.method},this.action=function(){return o.action},this.successBehaviour=function(){return o.successBehaviour},this.data=function(){return o.data},this.validate=function(){return a=new c,(i=new l(this,a)).run()},this.reset=function(){t.trigger("reset")}},v={clearErrors:function(e){e.instance().find(r+" "+o).removeClass(n.classShow)},displayAlert:function(e){},displayErrors:function(t,i){var a;for(var r in i)if(i.hasOwnProperty(r)){if("alert"==r){this.displayAlert(i[r]);continue}a=e.isArray(i[r])?i[r][0]:i[r],t.instance().find("["+n.dataValidationSegment+'="'+r+'"] ['+n.dataValidationCase+'="'+a+'"]').addClass(n.classShow)}},beginRequest:function(e){if(e.instance().data("quiet"))return!0;e.instance().find(s).addClass(n.classHide),e.instance().find(u).removeClass(n.classHide)},endRequest:function(e){if(e.instance().data("quiet"))return!0;e.instance().find(s).removeClass(n.classHide),e.instance().find(u).addClass(n.classHide)},successBehaviour:function(e,t){h.run(e,t)},disableForm:function(e){this.submitted=e},enableForm:function(){this.submitted=null},endRequestDisplayErrors:function(e,t){this.endRequest(e),this.displayErrors(e,t)},endRequestDisplayErrorsReset:function(e,t){this.endRequestDisplayErrors(e,t),e.reset()},formAction:function(t,i,a,r){var o=this;e.when(t.validate()).done(function(e,r,s){o.beginRequest(t),n.actionMethod(o,t,i,a)}).fail(r)},submit:function(t){var i=this;e(t).on("submit",function(t){t.preventDefault();var a=new m(e(this));i.clearErrors(a),i.formAction(a,function(e){n.postAjaxSuccess(i,a,e)},function(e,t,r){n.postAjaxFailure(i,a,e,t,r)},function(e){i.endRequestDisplayErrors(a,e)})})},init:function(e){this.submit(e)}};return v.init(this)}}()});