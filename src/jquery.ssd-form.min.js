/*
 * ssdForm jQuery plugin
 * Examples and documentation at: https://github.com/sebastiansulinski/ssd-form
 * Copyright (c) 2017 Sebastian Sulinski
 * Version: 1.5.3 (26-DEC-2017)
 * Licensed under the MIT.
 * Requires: jQuery v1.9 or later
 */
!function(e,n){"function"==typeof define&&define.amd?define(["jquery"],function(e){return n(e)}):"object"==typeof exports?module.exports=n(require("jquery")):n(e.jQuery)}(this,function(e){!function(){"use strict";e.fn.ssdForm=function(n){var t=e.extend({dataFormWrapper:"data-form-wrapper",dataConfirmation:"data-confirmation",dataValidationSegment:"data-validation",dataValidationCase:"data-case",dataSubmitTrigger:"data-submit-trigger",dataSubmitPending:"data-submit-pending",classCkEditor:"editor",classHide:"hide",classShow:"show",extendBehaviours:{},extendValidationRules:{},postAjaxSuccess:function(e,n,t){e.successBehaviour(n,t)},postAjaxFailure:function(e,n,t,i,r){e.endRequestDisplayErrors(n,t.responseJSON)},ignoreElements:".button, [disabled]",serializeAttribute:"name",actionMethod:function(n,t,i,r){e.ajax({method:t.method(),url:t.action(),data:t.data(),dataType:"json",cache:!1,success:i,error:r})}},n),i="["+t.dataFormWrapper+"]",r="["+t.dataConfirmation+"]",a="["+t.dataValidationSegment+"]",s="["+t.dataValidationCase+"]",o="["+t.dataSubmitTrigger+"]",u="["+t.dataSubmitPending+"]",c=function(){var e={};this.add=function(n,t){if(e.hasOwnProperty(n))return!1;e[n]=t},this.all=function(){return e},this.empty=function(){return 0===Object.keys(e).length}},d={replace:function(n){void 0!==n.replace&&e.each(n.replace,function(n,t){e("[data-"+n+"]").html(t)})},remove:function(n){void 0!==n.remove&&e.each(n.remove,function(n,t){e("[data-"+t+"]").remove()})},reload:function(){window.location.reload(!0)},redirect:function(e){window.location.href=e}},l=e.extend({elements:[],required:function(e){return!(""===e.value||null===e.value||void 0===e.value)},checked:function(e){return e.isChecked},radio:function(e){return this.checked(e)},value_is:function(e){return e.value===e.rules_collection[0]},email:function(e){return/^[a-zA-Z0-9._\-]+@[a-zA-Z0-9]+([.\-]?[a-zA-Z0-9]+)?([\.]{1}[a-zA-Z]{2,4}){1,4}$/.test(e.value)},password:function(e){return/(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/.test(e.value)},min:function(e){return e.value.length>=e.rules_collection[0]},max:function(e){return e.value.length<=e.rules_collection[0]},confirmed:function(e){var n=e.name+"_confirmation",t=this.elements.filter(function(e){return e.name===n})[0];if(!t)throw new Error(e.name+"_confirmation field is missing");return t.value===e.value},regex:function(e){return new RegExp(e.regex).test(e.value)},test:function(n,t){var i=this,r=e.Deferred();return i.elements=n,e.each(t.rules,function(e,n){var a=n.split(":"),s=a.shift();t.rules_collection=a,i[s](t)||r.reject(s),e+1===t.rules.length&&r.resolve()}),r.promise()}},t.extendValidationRules),f=function(n,t){function i(e){return e.isVisible||e.isEditor}function r(n,t){return-1===e.inArray("required",t.rules)&&""===t.value||l.test(n,t)}function a(e,n,i){e+1===n&&(t.empty()?i.resolve():i.reject(t.all()))}if(!(n instanceof m))throw new Error("Invalid argument form_model.");if(!(t instanceof c))throw new Error("Invalid argument error.");this.run=function(){var s=n.inputs(),o=s.length,u=e.Deferred();return e.each(s,function(n,c){return i(c)?void 0===c.rules||0===c.rules.length?(a(n,o,u),!0):(c.rules=c.rules.split("|"),void e.when(r(s,c)).done(function(){a(n,o,u)}).fail(function(e){t.add(c.name,e),a(n,o,u)})):(a(n,o,u),!0)}),u.promise()}},h=e.extend({redirect:function(e,n){if(!n.redirect)throw new Error("Redirect entry missing.");d.redirect(n.redirect)},reload:function(){d.reload()},fadeOutShowMessage:function(e,n){var t=e.instance().closest(i).find(r);e.instance().fadeOut(200,function(){t.html(n.message).fadeIn(200)})},fadeOutShowMessageRedirect:function(e,n){var t=e.instance().closest(i).find(r);e.instance().fadeOut(200,function(){t.html(n.message).fadeIn(200,function(){setTimeout(function(){window.location.href=n.redirect},3e3)})})},fadeOutShowMessageReload:function(e,n){var t=e.instance().closest(i).find(r);e.instance().fadeOut(200,function(){t.html(n.message).fadeIn(200,function(){setTimeout(function(){window.location.reload(!0)},3e3)})})},fadeOutShowMessageResetFadeIn:function(e,n){var t=e.instance().closest(i).find(r);e.instance().fadeOut(200,function(){v.endRequest(e),t.html(n.message).fadeIn(200),setTimeout(function(){t.fadeOut(200,function(){e.instance()[0].reset(),e.instance().fadeIn(200)})},3e3)})},callReplaceRemove:function(e,n){d.replace(n),d.remove(n)},ask:function(e,n){if(!this.hasOwnProperty(n.behaviour))throw new Error("Behaviour not specified.");this[n.behaviour](e,n)},run:function(e,n){var t=e.successBehaviour();if(!this.hasOwnProperty(t))throw new Error("Behaviour does not exist.");this[t](e,n)}},t.extendBehaviours),m=function(n){var i=n.serializeArray(),r=function(n){var i=[],r=[],a=[];return n.each(function(n,s){var o=e(s),u=o.attr(t.serializeAttribute).split("["),c={name:u[0],type:s.type,rules:o.data("validate"),isArray:u.length>1,isChecked:o.is(":checked"),isVisible:o.is(":visible"),isEditor:o.hasClass("editor"),regex:o.data("regex")};if(o.hasClass(t.classCkEditor)?c.value=window.CKEDITOR.instances[o.attr("id")].getData():c.value=o.val(),"radio"===c.type){if(a[c.name]){if(!c.isChecked)return;return c.rules=i[a[c.name]].rules,void i.splice(a[c.name],1,c)}a[c.name]=i.length}if(c.isArray){if(r[c.name]){if("checkbox"===c.type&&!c.isChecked)return;return void i[r[c.name]].value.push(c.value)}c.value=[c.value],"checkbox"!==c.type||c.isChecked||(c.value=[]),r[c.name]=i.length}i.push(c)}),i}(n.find(":input").not(t.ignoreElements)),a=n.prop("method"),s=n.prop("action"),o=n.data("success-behaviour");!function(){if(void 0===a&&(a="post"),void 0===s)throw new Error("No action defined.")}(),this.instance=function(){return n},this.method=function(){return a},this.action=function(){return s},this.successBehaviour=function(){return o},this.inputs=function(){return r},this.data=function(){return i},this.validate=function(){return new f(this,new c).run()},this.reset=function(){n.trigger("reset")}},v={clearErrors:function(e){e.instance().find(a+" "+s).removeClass(t.classShow)},displayAlert:function(e){},displayErrors:function(n,i){var r;for(var a in i)if(i.hasOwnProperty(a)){if("alert"===a){this.displayAlert(i[a]);continue}r=e.isArray(i[a])?i[a][0]:i[a],n.instance().find("["+t.dataValidationSegment+'="'+a+'"] ['+t.dataValidationCase+'="'+r+'"]').addClass(t.classShow)}},beginRequest:function(e){if(e.instance().data("quiet"))return!0;e.instance().find(o).addClass(t.classHide),e.instance().find(u).removeClass(t.classHide)},endRequest:function(e){if(e.instance().data("quiet"))return!0;e.instance().find(o).removeClass(t.classHide),e.instance().find(u).addClass(t.classHide)},successBehaviour:function(e,n){h.run(e,n)},disableForm:function(e){this.submitted=e},enableForm:function(){this.submitted=null},endRequestDisplayErrors:function(e,n){this.endRequest(e),this.displayErrors(e,n)},endRequestDisplayErrorsReset:function(e,n){this.endRequestDisplayErrors(e,n),e.reset()},formAction:function(n,i,r,a){var s=this;e.when(n.validate()).done(function(e,a,o){s.beginRequest(n),t.actionMethod(s,n,i,r)}).fail(a)},submit:function(n){var i=this;e(n).on("submit",function(n){n.preventDefault();var r=new m(e(this));i.clearErrors(r),i.formAction(r,function(e){t.postAjaxSuccess(i,r,e)},function(e,n,a){t.postAjaxFailure(i,r,e,n,a)},function(e){i.endRequestDisplayErrors(r,e)})})},init:function(e){this.submit(e)}};return v.init(this)}}()});